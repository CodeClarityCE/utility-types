package knowledge

import (
	"time"

	"github.com/google/uuid"
	"github.com/uptrace/bun"
)

// PackageVulnerability represents a link between a package and a vulnerability.
// Uses FK references to OSV/NVD/FriendsOfPHP/GCVE tables instead of denormalized data.
// Exactly one of OsvId, NvdId, FriendsOfPhpId, or GcveId must be set.
type PackageVulnerability struct {
	bun.BaseModel    `bun:"table:package_vulnerability,alias:pv"`
	Id               uuid.UUID  `bun:",pk,type:uuid,default:uuid_generate_v4()"`
	PackageName      string     `bun:"package_name,notnull"`
	PackageEcosystem string     `bun:"package_ecosystem,notnull"` // npm, packagist
	OsvId            *uuid.UUID `bun:"osv_id,type:uuid"`          // FK to osv.id
	NvdId            *uuid.UUID `bun:"nvd_id,type:uuid"`          // FK to nvd.id
	FriendsOfPhpId   *uuid.UUID `bun:"friendsofphp_id,type:uuid"` // FK to friends_of_php.id
	GcveId           *uuid.UUID `bun:"gcve_id,type:uuid"`          // FK to gcve.id
	CreatedAt        time.Time  `bun:"created_at,default:current_timestamp"`
}
